{#
/**
 * @file
 * Theme override to display a UMD Terp Homepage node.
 */
#}

{%
  set hero_classes = [
    'home-hero',
    node.field_umdt_ct_hero_dark.value ? 'home-hero-dark',
		node.field_umdt_ct_hero_video.value ? 'home-hero-video',
    node.field_umdt_ct_hero_style.value ? node.field_umdt_ct_hero_style.value|clean_class,
  ]
%}

<div {{attributes.addClass(hero_classes)}}>
  {% if content.field_umdt_ct_hero_title|field_value %}
  {% else %}
    <h1 class="embedded-heading">{{ node.title.value }}</h1>
  {% endif %}
  {{ title_suffix }}
  {% if content.field_umdt_ct_hero_title|field_value or content.field_umdt_ct_hero_subtitle|field_value or content.field_umdt_ct_hero_text|field_value or content.field_umdt_ct_hero_image|field_value or content.field_umdt_ct_hero_video|field_value %}
    <div class="max-bound">
      {% if content.field_umdt_ct_hero_image|field_value or content.field_umdt_ct_hero_video|field_value %}
        <div class="home-hero-media">
          {% if content.field_umdt_ct_hero_video|field_value %}
            <video class="lazyload" aria-hidden="true" data-src="{{ file_url(content.field_umdt_ct_hero_video[0]['#media'].field_media_video_file.entity.uri.value) }}" poster="{{ file_url(content.field_umdt_ct_hero_image[0]['#media'].field_media_image.entity.uri.value | image_style('optimized')) }}" muted loop></video>
            <noscript>
              <video aria-hidden="true" src="{{ file_url(content.field_umdt_ct_hero_video[0]['#media'].field_media_video_file.entity.uri.value) }}" poster="{{ file_url(content.field_umdt_ct_hero_image[0]['#media'].field_media_image.entity.uri.value | image_style('optimized')) }}" autoplay muted loop></video>
            </noscript>
          {% elseif content.field_umdt_ct_hero_image|field_value %}
            {% if node.field_umdt_ct_hero_style.value == 'home-hero-bg' %}
              {% if content.field_umdt_ct_hero_image['#items']|length > 1 %}
                {% set is_fullwidth_list = 'true' %}
              {% endif %}
              <div class="hero-block-container" id="hero-block-fullwidth" style="background-image: url({{ file_url(content.field_umdt_ct_hero_image[0]['#media'].field_media_image.entity.uri.value | image_style('optimized')) }});">
            {% else %}
              <div class="hero-block-container" style="height: 100%; background-image: url({{ file_url(content.field_umdt_ct_hero_image[0]['#media'].field_media_image.entity.uri.value | image_style('optimized_square')) }});">
            {% endif %}
            <div class="hero-block">
              {{ hero_block }}
            </div>
          </div>
        {% endif %}
        {% if content.field_cta_text|field_value %}
          <div class="home-hero-cta"><div id="cta-text">{{ content.field_cta_text|field_value }}</div></div>
        {% endif %}
      </div>
      {% endif %}
      {% if content.field_umdt_ct_hero_title|field_value or content.field_umdt_ct_hero_subtitle|field_value or content.field_umdt_ct_hero_text|field_value %}
        <div class="home-hero-content">
          <div class="outer-pad">
            <div class="editor-content">
              {% if content.field_umdt_ct_hero_title|field_value %}
                <h1>{{ content.field_umdt_ct_hero_title|field_value }}</h1>
              {% endif %}
              {% if content.field_umdt_ct_hero_subtitle|field_value %}
                <h2>{{ content.field_umdt_ct_hero_subtitle|field_value }}</h2>
              {% endif %}
              {% if content.field_umdt_ct_hero_text|field_value %}
                <p>{{ content.field_umdt_ct_hero_text|field_value }}</p>
              {% endif %}
            </div>
          </div>
        </div>
      {% endif %}
    </div>
  {% endif %}
</div>
<div id="terp-page-content">
  {{ content|without('field_umdt_ct_hero_video', 'field_umdt_ct_hero_dark', 'field_umdt_ct_hero_style', 'field_umdt_ct_hero_image', 'field_umdt_ct_hero_title', 'field_umdt_ct_hero_subtitle', 'field_umdt_ct_hero_text', 'field_umdt_ct_hero_cta', 'field_cta_text') }}
</div>

{% if is_fullwidth_list is not empty %}
  <script>
    const imageUrls = [
      {% for item in content.field_umdt_ct_hero_image %}
        {% set furl = file_url(item['#media'].field_media_image.entity.uri.value) %}
        {% if furl is not empty %}
          "{{ furl }}",
        {% endif %}
      {% endfor %}
    ];

    function changeHeroBackground() {
      const imgs = imageUrls.filter(Boolean);
      let bgDiv = document.getElementById("hero-block-fullwidth");

      let randomIndex = Math.floor(
        Math.random() * imgs.length
      );
      let randomImageUrl = imgs[randomIndex];

      bgDiv.style.backgroundImage =
        "url('" + randomImageUrl + "')";
    }

    if (imageUrls.length > 0) {
      changeHeroBackground();
    }
  </script>
{% endif %}
