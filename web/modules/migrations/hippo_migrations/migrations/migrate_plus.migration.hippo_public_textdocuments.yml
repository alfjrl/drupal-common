# Migration configuration for imported articles.
---
id: hippo_public_textdocuments
label: 'Import public:textdocument documents from Hippo CMS'
migration_group: Hippo
migration_dependencies:
  optional: []
  required: []
destination:
  plugin: entity:node
  default_bundle: umd_terp_basic_page
source:
  plugin: url
  data_fetcher_plugin: http
  data_parser_plugin: json
  urls:
    - https://www.lib.umd.edu/h2dapi/documents?_nodetype=public:textdocument&_query=UMDMIGRATE&_attributes=public:body,public:migrate_flag,public:title,pubwfLastModificationDate,pubwfCreationDate&_offset=0&_max=25
    - https://www.lib.umd.edu/h2dapi/documents?_nodetype=public:textdocument&_query=UMDMIGRATE&_attributes=public:body,public:migrate_flag,public:title,pubwfLastModificationDate,pubwfCreationDate&_offset=25&_max=25
    - https://www.lib.umd.edu/h2dapi/documents?_nodetype=public:textdocument&_query=UMDMIGRATE&_attributes=public:body,public:migrate_flag,public:title,pubwfLastModificationDate,pubwfCreationDate&_offset=50&_max=25
    - https://www.lib.umd.edu/h2dapi/documents?_nodetype=public:textdocument&_query=UMDMIGRATE&_attributes=public:body,public:migrate_flag,public:title,pubwfLastModificationDate,pubwfCreationDate&_offset=75&_max=25
    - https://www.lib.umd.edu/h2dapi/documents?_nodetype=public:textdocument&_query=UMDMIGRATE&_attributes=public:body,public:migrate_flag,public:title,pubwfLastModificationDate,pubwfCreationDate&_offset=100&_max=25
    - https://www.lib.umd.edu/h2dapi/documents?_nodetype=public:textdocument&_query=UMDMIGRATE&_attributes=public:body,public:migrate_flag,public:title,pubwfLastModificationDate,pubwfCreationDate&_offset=125&_max=25
    - https://www.lib.umd.edu/h2dapi/documents?_nodetype=public:textdocument&_query=UMDMIGRATE&_attributes=public:body,public:migrate_flag,public:title,pubwfLastModificationDate,pubwfCreationDate&_offset=150&_max=25
    # - http://host.docker.internal:8080/site/api/documents?_nodetype=public:textdocument&_query=migrateme&_attributes=public:body,public:migrate_flag,public:title,pubwfLastModificationDate,pubwfCreationDate&_offset=0&_max=50

  item_selector: items/

  fields:
    -
      name: id
      label: 'ID'
      selector: id
    -
      name: name
      label: 'Name'
      selector: /name
    -
      name: title
      label: 'Title'
      selector: /items/public:title
    -
      name: body
      label: 'Body'
      selector: /items/public:body/content
    -
      name: summary
      label: 'Summary'
      selector: /items/public:summary
    -
      name: locale
      label: 'Locale'
      selector: /locale
    -
      name: created
      label: 'Created'
      selector: pubwfCreationDate
    -
      name: changed
      label: 'changed'
      selector: pubwfLastModificationDate
    -
      name: binaries
      label: 'Binaries'
      selector: /items/public:body/links/
  ids:
    id:
      type: string
  constants:
    file_destination: 'public://imported/'

process:
  title:
    plugin: skip_on_empty
    source: title
    method: row
    message: 'Title is missing'
  field_id: id
  type:
    plugin: default_value
    default_value: umd_terp_basic_page
  pseudo_body:
    plugin: body_prepare
    source: body
  body/value: '@pseudo_body'
  body/format:
    plugin: default_value
    default_value: full_html
  body/summary: summary
  created:
    plugin: format_date
    from_format: Y-m-d\TH:i:s.vP
    to_format: U
    source: created
  changed:
    plugin: format_date
    from_format: Y-m-d\TH:i:s.vP
    to_format: U
    source: changed
  field_migrated_source_date: changed
  langcode:
    plugin: default_value
    source: locale
    default_value: en
  pseudo_image:
    plugin: binaries_prepare
    source: binaries
  field_migrated_files:
    plugin: image_import
    source: '@pseudo_image'
    destination: 'constants/file_destination'
